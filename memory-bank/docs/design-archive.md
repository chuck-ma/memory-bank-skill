## 状态

已确认 v1

## 背景

`active.md` 作为高频更新文件，容易持续增长，导致每次会话自动加载上下文时内容过多。需要一个归档机制，将已完成/已落地的内容从 `active.md` 中移出，同时保留可追溯的历史记录。

## 目标

1. 控制 `active.md` 的规模，保持焦点信息精简。
2. 历史记录可追溯，支持按需检索。
3. 归档过程可由 AI 在更新 Memory Bank 时执行，无需新增外部服务。

## 非目标

1. 不引入插件侧的归档提醒（本次不做）。
2. 不做自动摘要或压缩。
3. 不改变 Memory Bank 的固定加载文件列表。

## 归档策略

### 触发条件

满足任一条件时执行归档：

- `active.md` 行数超过 120 行
- 已完成条目超过 20 条

已完成条目定义：

- 优先统计 `active.md` 中“已完成（待归档）”区块内的 `- [x]`
- 若该区块缺失，则统计 `active.md` 中所有 `- [x]` 项

### 归档范围

从 `active.md` 中移出：

- 已完成/已落地/已关闭的条目
- 超过 30 天的“最近变更”记录

保留：

- 当前焦点
- 下一步
- 阻塞项
- 最近 30 天的变更记录

### 归档目标

归档文件位置：`memory-bank/archive/`

命名规范：

- `active_YYYY-MM.md`

## 归档流程（AI 执行）

1. 检查 `active.md` 触发条件
2. 如需归档：
   - 创建或更新当月 `active_YYYY-MM.md`
   - 将归档内容追加到归档文件 MACHINE_BLOCK_END 之前
   - 从 `active.md` 删除已归档条目
3. 更新 `memory-bank/_index.md` 记录归档文件

## 文件模板

归档文件格式（与模板一致）：

```markdown
# Active Archive - {YYYY-MM}

<!-- MACHINE_BLOCK_START -->
> 归档于: {YYYY-MM-DD}

## 已完成条目
- {条目}

## 最近变更（历史）
| 日期 | 变更 |
|------|------|
<!-- MACHINE_BLOCK_END -->

<!-- USER_BLOCK_START -->
## 备注
{用户自由编辑区}
<!-- USER_BLOCK_END -->
```

## 风险与兜底

- 若 `active.md` 没有明确“已完成（待归档）”字段，允许按语义判断（完成/已落地/已关闭）。
- 如果当月归档文件不存在，需先创建并加入索引。
